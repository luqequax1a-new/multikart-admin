import{a as j}from"./chunk-GG7AHMIJ.js";import{Ia as x,qa as C,sa as y,ta as I,ua as f}from"./chunk-IKKQDHIF.js";import{d as w}from"./chunk-EY6JDCC6.js";import{$ as g,ea as h,ja as d,l as s,n as S}from"./chunk-KIZZVTEV.js";import{a as _,b as q}from"./chunk-4CLCTAJ7.js";var N=(()=>{let e=class e{};e.type="[Cart] Get";let i=e;return i})(),k=(()=>{let e=class e{constructor(o){this.payload=o}};e.type="[Cart] Add";let i=e;return i})(),v=(()=>{let e=class e{constructor(o){this.payload=o}};e.type="[Cart] Update";let i=e;return i})(),b=(()=>{let e=class e{constructor(o){this.id=o}};e.type="[Cart] Delete";let i=e;return i})(),D=(()=>{let e=class e{constructor(){}};e.type="[Cart] Clear";let i=e;return i})();var H=(()=>{let e=class e{constructor(){this.http=d(w)}getCartItems(){return this.http.get(`${j.URL}/cart.json`)}};e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var n,c=(n=class{constructor(){this.cartService=d(H),this.notificationService=d(x),this.store=d(C)}static cartItems(e){return e.items}static cartTotal(e){return e.total}static cartHasDigital(e){return e.is_digital_only}getCartItems(e){return this.cartService.getCartItems().pipe(g({next:r=>{e.patchState(r)},error:r=>{throw new Error(r?.error?.message)}}))}add(e,r){if(r.payload.id)this.store.dispatch(new v(r.payload));else{let o=r.payload.variation?r.payload.variation.sale_price:r.payload.product?.sale_price,t={items:[{id:Number(Math.floor(Math.random()*1e4).toString().padStart(4,"0")),quantity:r.payload.quantity,sub_total:o?o*r.payload.quantity:0,product:r.payload.product,product_id:r.payload.product_id,variation:r.payload.variation,variation_id:r.payload?r.payload.variation_id:null}]},a=e.getState(),m=[...a.items].findIndex(p=>p.id===t.items[0].id),l=_({},a);m==-1&&(l.items=[...a.items,...t.items]),l.total=l.items.reduce((p,A)=>p+Number(A.sub_total),0),e.patchState(l)}}update(e,r){let o=e.getState(),t=[...o.items],a=t.findIndex(l=>l.id===r.payload.id),u=t[a]?.variation?t[a]?.variation?.quantity:t[a]?.product?.quantity;if(u<t[a]?.quantity+r?.payload.quantity)return this.notificationService.showError(`You cannot add more than ${u} items available in stock.`),!1;if(t[a].quantity=t[a]?.quantity+r?.payload.quantity,t[a].product?.wholesales?.length){let l=t[a].product.wholesales.find(p=>p.min_qty<=t[a].quantity&&p.max_qty>=t[a].quantity)||null;l&&t[a].product.wholesale_price_type=="fixed"?(t[a].sub_total=t[a].quantity*l.value,t[a].wholesale_price=t[a].sub_total/t[a].quantity):l&&t[a].product.wholesale_price_type=="percentage"?(t[a].sub_total=t[a].quantity*(t[a]?.variation?t[a]?.variation?.sale_price:t[a].product.sale_price),t[a].sub_total=t[a].sub_total-t[a].sub_total*(l.value/100),t[a].wholesale_price=t[a].sub_total/t[a].quantity):(t[a].sub_total=t[a]?.quantity*(t[a]?.variation?t[a]?.variation?.sale_price:t[a].product.sale_price),t[a].wholesale_price=null)}else t[a].sub_total=t[a]?.quantity*(t[a]?.variation?t[a]?.variation?.sale_price:t[a].product.sale_price),t[a].wholesale_price=null;if(t[a].quantity<1)return this.store.dispatch(new b(r.payload.id)),S();let m=o.items.reduce((l,p)=>l+Number(p.sub_total),0);return e.patchState(q(_({},o),{total:m})),!0}delete(e,{id:r}){let o=e.getState(),t=o.items.filter(u=>u.id!==r),a=o.items.reduce((u,m)=>u+Number(m.sub_total),0);return e.patchState({items:t,total:a}),!0}clearCart(e){e.patchState({items:[],total:0})}},n.\u0275fac=function(r){return new(r||n)},n.\u0275prov=h({token:n,factory:n.\u0275fac}),n);s([y(N)],c.prototype,"getCartItems",null);s([y(k)],c.prototype,"add",null);s([y(v)],c.prototype,"update",null);s([y(b)],c.prototype,"delete",null);s([y(D)],c.prototype,"clearCart",null);s([f()],c,"cartItems",null);s([f()],c,"cartTotal",null);s([f()],c,"cartHasDigital",null);c=s([I({name:"cart",defaults:{is_digital_only:null,items:[],total:0}})],c);export{N as a,k as b,v as c,c as d};
