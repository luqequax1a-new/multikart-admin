import{a as D,b as ue,c as fe,d as _e}from"./chunk-E4BARP3C.js";import{l as ae,m as oe}from"./chunk-HMBOAMDM.js";import{a as me}from"./chunk-JCQMHXSD.js";import{a as de}from"./chunk-KRRVKEPJ.js";import{a as pe}from"./chunk-GJUMWKSA.js";import{a as se}from"./chunk-6TS3CAIM.js";import"./chunk-2MGWSW7E.js";import"./chunk-T5ULGFUG.js";import"./chunk-YJGMUJNE.js";import{a as ce}from"./chunk-3ARB4UI6.js";import"./chunk-HD5XXWEJ.js";import"./chunk-HJPVTB2W.js";import{a as le}from"./chunk-MLWMDQKS.js";import{a as re}from"./chunk-MPC4A6Z2.js";import"./chunk-Q3XL2YFP.js";import"./chunk-5DTRVH74.js";import"./chunk-GG7AHMIJ.js";import{B as Z,C as ee,D as te,d as L,e as V,g as W,h as z,k as B,m as J,n as K,q as X,qa as x,t as Y}from"./chunk-IKKQDHIF.js";import"./chunk-OTODDIHK.js";import"./chunk-EY6JDCC6.js";import{c as ie,d as ne}from"./chunk-AWERIOQH.js";import{Ad as j,Bc as O,Ed as H,Fc as U,Ib as N,Ja as A,Kb as G,Lc as d,Mc as m,Pb as a,Qb as l,Rb as s,Sb as w,Zc as q,_b as y,bb as n,bc as h,dc as f,gb as k,ja as c,kc as $,lc as R,mc as M,ob as E,qa as _,qc as P,ra as b,rc as C,sc as T,tc as S,td as Q,ub as I,va as F}from"./chunk-KIZZVTEV.js";import"./chunk-4CLCTAJ7.js";var be=["confirmationModal"],he=()=>[];function Ce(o,p){if(o&1&&(w(0,"select2",6),d(1,"async"),d(2,"async"),d(3,"translate")),o&2){let r,i=f();a("data",(r=m(1,2,i.users$))!=null&&r.length?m(2,4,i.users$):U(8,he))("placeholder",m(3,6,"select_consumer"))}}function ve(o,p){if(o&1){let r=y();l(0,"app-button",18),h("click",function(){_(r);let e=f();return b(e.form.valid&&e.ConfirmationModal().openModal("credit"))}),C(1),d(2,"translate"),s()}if(o&2){let r=f();P("btn btn-animation"),a("disabled",!r.form.valid)("spinner",!1),n(),S(" ",m(2,5,"add")," ")}}function ge(o,p){if(o&1){let r=y();l(0,"app-button",19),h("click",function(){_(r);let e=f(),t=M(19);return b((+e.balance<+t.value||!!t.value)&&e.ConfirmationModal().openModal("debit"))}),C(1),d(2,"translate"),s()}if(o&2){let r=f(),i=M(19);P("btn btn-light-bg"),a("spinner",!1)("disabled",+r.balance<+i.value||!i.value),n(),S(" ",m(2,5,"withdraw")," ")}}var qe=(()=>{let p=class p{constructor(){this.document=c(F),this.renderer=c(k),this.store=c(x),this.formBuilder=c(Z),this.users$=c(x).select(me.users),this.point$=c(x).select(_e.point),this.ConfirmationModal=q("confirmationModal"),this.balance=0,this.tableConfig={columns:[{title:"points",dataField:"amount"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0};let i=c(A);this.isBrowser=H(i),this.store.dispatch(new de({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new B("",[V.required]),balance:new B("",[V.required])}),this.form.controls.consumer_id.valueChanges.subscribe(e=>{e?(this.paginateInitialData.consumer_id=e,this.store.dispatch(new D(this.paginateInitialData)),this.point$.subscribe(t=>{let v=t?.transactions?.data?.filter(u=>(u.type_status=u.type?`<div class="status-${u.type}"><span>${u.type.replace(/_/g," ")}</span></div>`:"-",u));this.balance=t?t?.balance:0,this.tableConfig.data=t?v:[],this.tableConfig.total=t?t?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(i){this.paginateInitialData=i;let e=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=e,e&&this.store.dispatch(new D(i))}submit(i){this.form.markAllAsTouched();let e=new ue(this.form.value);i=="debit"&&(e=new fe(this.form.value)),this.form.valid&&this.store.dispatch(e).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}};p.\u0275fac=function(e){return new(e||p)},p.\u0275cmp=E({type:p,selectors:[["app-point"]],viewQuery:function(e,t){e&1&&$(t.ConfirmationModal,be,5),e&2&&R()},decls:28,vars:21,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-copper-diamond-line"],["type","number","formControlName","balance","numbersOnly","",1,"form-control",3,"placeholder"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(e,t){if(e&1){let v=y();l(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),N(4,Ce,4,9,"select2",6),s()()(),l(5,"div",7)(6,"form",4)(7,"app-page-wrapper",5)(8,"div",8)(9,"div",9)(10,"div",10),w(11,"i",11),s(),l(12,"div")(13,"h2"),C(14),s(),l(15,"h5"),C(16),d(17,"translate"),s()()(),w(18,"input",12,0),d(20,"translate"),l(21,"div",13),I(22,ve,3,7,"app-button",14)(23,ge,3,7,"app-button",15),s()()()()()(),l(24,"app-page-wrapper",5)(25,"app-table",16),h("tableChanged",function(g){return _(v),b(t.onTableChange(g))}),s()(),l(26,"app-confirmation-modal",17,1),h("confirmed",function(g){return _(v),b(t.submit(g==null?null:g.actionToPerform))}),s()}e&2&&(n(2),a("formGroup",t.form),n(),a("gridClass","col-sm-12")("title","select_consumer"),n(),G(t.isBrowser?4:-1),n(2),a("formGroup",t.form),n(),a("gridClass","col-sm-12")("title","point"),n(7),T(t.balance==null?null:t.balance.toFixed(2)),n(2),T(m(17,17,"point_balance")),n(2),a("placeholder",O(m(20,19,"add_withdraw_amount"))),n(4),a("hasPermission","point.credit"),n(),a("hasPermission","point.debit"),n(),a("gridClass","col-sm-12")("title","transactions"),n(),a("dateRange",!0)("tableConfig",t.tableConfig))},dependencies:[j,ne,ee,J,L,K,W,z,ce,te,X,Y,oe,ae,re,le,pe,se,Q,ie],encapsulation:2});let o=p;return o})();export{qe as Point};
