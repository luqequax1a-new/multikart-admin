import{a as P,b as _e,c as be,d as he}from"./chunk-7WDTCRHE.js";import{l as re,m as oe}from"./chunk-HMBOAMDM.js";import{a as fe}from"./chunk-JCQMHXSD.js";import{a as ue}from"./chunk-KRRVKEPJ.js";import{a as de}from"./chunk-GJUMWKSA.js";import{a as ce}from"./chunk-6TS3CAIM.js";import{a as se}from"./chunk-2MGWSW7E.js";import"./chunk-T5ULGFUG.js";import{d as ne}from"./chunk-YJGMUJNE.js";import{a as me}from"./chunk-3ARB4UI6.js";import"./chunk-HD5XXWEJ.js";import"./chunk-HJPVTB2W.js";import{a as pe}from"./chunk-MLWMDQKS.js";import{a as le}from"./chunk-MPC4A6Z2.js";import"./chunk-Q3XL2YFP.js";import"./chunk-5DTRVH74.js";import"./chunk-GG7AHMIJ.js";import{B as Z,C as ee,D as te,d as H,e as D,g as L,h as z,k as F,m as J,n as K,q as X,qa as C,t as Y}from"./chunk-IKKQDHIF.js";import"./chunk-OTODDIHK.js";import"./chunk-EY6JDCC6.js";import{c as ie,d as ae}from"./chunk-AWERIOQH.js";import{Ad as Q,Bc as V,Ed as j,Fc as O,Ib as N,Ja as A,Kb as G,Lc as p,Mc as c,Pb as n,Qb as l,Rb as s,Sb as y,Zc as U,_b as x,bb as a,bc as h,dc as f,gb as k,ja as m,kc as R,lc as $,mc as M,ob as E,qa as _,qc as S,ra as b,rc as g,sc as T,tc as B,td as q,ub as I,va as W}from"./chunk-KIZZVTEV.js";import"./chunk-4CLCTAJ7.js";var ge=["confirmationModal"],Ce=()=>[];function ve(r,d){if(r&1&&(y(0,"select2",6),p(1,"translate"),p(2,"async"),p(3,"async"),p(4,"translate")),r&2){let o,i=f();n("noResultMessage",V(c(1,4,"no_data_found")))("data",(o=c(2,6,i.users$))!=null&&o.length?c(3,8,i.users$):O(12,Ce))("placeholder",c(4,10,"select_consumer"))}}function we(r,d){if(r&1){let o=x();l(0,"app-button",18),h("click",function(){_(o);let e=f();return b(e.form.valid&&e.ConfirmationModal().openModal("credit"))}),g(1),p(2,"translate"),s()}if(r&2){let o=f();S("btn btn-animation"),n("disabled",!o.form.valid)("spinner",!1),a(),B(" ",c(2,5,"add")," ")}}function ye(r,d){if(r&1){let o=x();l(0,"app-button",19),h("click",function(){_(o);let e=f(),t=M(20);return b(+e.balance<+t.value||!!t.value&&e.ConfirmationModal().openModal("debit"))}),g(1),p(2,"translate"),s()}if(r&2){let o=f(),i=M(20);S("btn btn-light-bg"),n("spinner",!1)("disabled",+o.balance<+i.value||!i.value),a(),B(" ",c(2,5,"withdraw")," ")}}var He=(()=>{let d=class d{constructor(){this.document=m(W),this.renderer=m(k),this.store=m(C),this.formBuilder=m(Z),this.users$=m(C).select(fe.users),this.wallet$=m(C).select(he.wallet),this.setting$=m(C).select(ne.setting),this.ConfirmationModal=U("confirmationModal"),this.balance=0,this.tableConfig={columns:[{title:"amount",dataField:"amount",type:"price"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0};let i=m(A);this.isBrowser=j(i),this.store.dispatch(new ue({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new F("",[D.required]),balance:new F("",[D.required])}),this.form.controls.consumer_id.valueChanges.subscribe(e=>{e?(this.paginateInitialData.consumer_id=e,this.store.dispatch(new P(this.paginateInitialData)),this.wallet$.subscribe(t=>{let v=t?.transactions?.data?.filter(u=>(u.type_status=u.type?`<div class="status-${u.type}"><span>${u.type.replace(/_/g," ")}</span></div>`:"-",u));this.balance=t?t?.balance:0,this.tableConfig.data=t?v:[],this.tableConfig.total=t?t?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(i){this.paginateInitialData=i;let e=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=e,e&&this.store.dispatch(new P(i))}submit(i){this.form.markAllAsTouched();let e=new _e(this.form.value);i=="debit"&&(e=new be(this.form.value)),this.form.valid&&this.store.dispatch(e).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}};d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=E({type:d,selectors:[["app-wallet"]],viewQuery:function(e,t){e&1&&R(t.ConfirmationModal,ge,5),e&2&&$()},decls:29,vars:23,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder","noResultMessage"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-wallet-line"],["type","number","formControlName","balance","numbersOnly","",1,"form-control",3,"placeholder"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(e,t){if(e&1){let v=x();l(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),N(4,ve,5,13,"select2",6),s()()(),l(5,"div",7)(6,"form",4)(7,"app-page-wrapper",5)(8,"div",8)(9,"div",9)(10,"div",10),y(11,"i",11),s(),l(12,"div")(13,"h2"),g(14),p(15,"currencySymbol"),s(),l(16,"h5"),g(17),p(18,"translate"),s()()(),y(19,"input",12,0),p(21,"translate"),l(22,"div",13),I(23,we,3,7,"app-button",14)(24,ye,3,7,"app-button",15),s()()()()()(),l(25,"app-page-wrapper",5)(26,"app-table",16),h("tableChanged",function(w){return _(v),b(t.onTableChange(w))}),s()(),l(27,"app-confirmation-modal",17,1),h("confirmed",function(w){return _(v),b(t.submit(w==null?null:w.actionToPerform))}),s()}e&2&&(a(2),n("formGroup",t.form),a(),n("gridClass","col-sm-12")("title","select_consumer"),a(),G(t.isBrowser?4:-1),a(2),n("formGroup",t.form),a(),n("gridClass","col-sm-12")("title","wallet"),a(7),T(c(15,17,t.balance)),a(3),T(c(18,19,"wallet_balance")),a(2),n("placeholder",V(c(21,21,"add_withdraw_amount"))),a(4),n("hasPermission","wallet.credit"),a(),n("hasPermission","wallet.debit"),a(),n("gridClass","col-sm-12")("title","transactions"),a(),n("dateRange",!0)("tableConfig",t.tableConfig))},dependencies:[Q,ae,ee,J,H,K,L,z,te,X,Y,me,oe,re,le,de,pe,ce,q,ie,se],encapsulation:2});let r=d;return r})();export{He as Wallet};
