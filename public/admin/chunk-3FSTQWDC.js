import{b as pe,c as ce,d as ue,e as he,h as F}from"./chunk-6GVVJ3D4.js";import{a as de}from"./chunk-Y2Z4WWCH.js";import{a as le}from"./chunk-MLWMDQKS.js";import{B as ne,C as me,D as ae,d as ee,e as q,g as ie,h as te,k as D,m as oe,q as re,qa as g,t as se}from"./chunk-IKKQDHIF.js";import{e as Y,g as Z}from"./chunk-OTODDIHK.js";import{c as E,d as S}from"./chunk-AWERIOQH.js";import{$b as C,Ad as X,Bc as x,Ca as z,Cc as N,Ib as T,Kb as M,Lc as a,Mc as l,Nb as R,Ob as A,Pb as k,Qb as c,Rb as h,Sb as H,Tb as _,Ub as f,Xc as J,Y as j,Yc as K,Z as L,_b as V,bb as r,bc as $,cc as I,dc as P,g as G,ja as u,n as O,ob as y,qa as w,ra as B,rc as d,sc as v,t as U,tc as b,td as Q,ud as W}from"./chunk-KIZZVTEV.js";var fe=(s,o)=>o.id;function Ce(s,o){if(s&1){let n=V();_(0,"li")(1,"div",4)(2,"input",7),I("change",function(t){let e=w(n).$implicit,m=P().$implicit,p=P();return B(e.name==="index"&&e.isChecked?p.checkIndex(t,m):p.onPermissionChecked(t,m))}),f(),_(3,"label",6),d(4),a(5,"titlecase"),f()()()}if(s&2){let n=o.$implicit,i=P(2);r(2),C("id",x(n.permission_id))("name",n.name)("checked",!!(i.selectedPermission.includes(+n.permission_id)||n.isChecked))("value",n.permission_id),r(),C("htmlFor",x(n.permission_id)),r(),b(" ",l(5,8,n.name)," ")}}function Pe(s,o){if(s&1){let n=V();_(0,"div",3)(1,"ul")(2,"li"),d(3),a(4,"titlecase"),f(),_(5,"li")(6,"div",4)(7,"input",5),I("change",function(t){let e=w(n).$implicit,m=P();return B(m.checkUncheckAll(t,e))}),f(),_(8,"label",6),d(9),a(10,"translate"),f()()(),R(11,Ce,6,10,"li",null,fe),f()()}if(s&2){let n=o.$implicit;r(3),v(l(4,7,n==null?null:n.name.replace("_"," "))),r(4),C("id",N("role-",n.id))("checked",n.isChecked),r(),C("htmlFor",N("role-",n.id)),r(),v(l(10,9,"all")),r(2),A(n.module_permissions)}}var _e=(()=>{let o=class o{constructor(){this.store=u(g),this.modules$=u(g).select(F.roleModules),this.selectedPermission=[],this.setPermissions=J(),this.store.dispatch(new pe)}ngOnChanges(i){let t=i.selectedPermission?.currentValue;this.modules$.subscribe(e=>{e?.map(m=>{m.module_permissions.map(p=>{p.isChecked=t.includes(p.id)})}),e?.filter(m=>{this.updateCheckBoxStatus(m)})})}checkUncheckAll(i,t){t.module_permissions.forEach(e=>{e.isChecked=i.target.checked,this.addPermission(i.target.checked,e?.id,t)})}checkIndex(i,t){t.module_permissions.forEach(e=>{e.isChecked=!1,this.addPermission(!1,e?.id,t)})}onPermissionChecked(i,t){t.module_permissions.forEach(e=>{e.isChecked=!1,e.name=="index"&&(e.isChecked=!e.isChecked,this.addPermission(!0,+e.id,t)),this.addPermission(i.target?.checked,+i?.target?.value,t)})}addPermission(i,t,e){let m=this.selectedPermission.indexOf(Number(t));i?m==-1&&this.selectedPermission.push(Number(t)):this.selectedPermission=this.selectedPermission.filter(p=>p!=Number(t)),this.setPermissions.emit(this.selectedPermission),this.updateCheckBoxStatus(e)}updateCheckBoxStatus(i){let t=0;i.module_permissions.filter(e=>{this.selectedPermission.includes(e.id)&&t++,i.module_permissions.length<=t?i.isChecked=!0:i.isChecked=!1})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=y({type:o,selectors:[["app-permissions"]],inputs:{selectedPermission:"selectedPermission"},outputs:{setPermissions:"setPermissions"},features:[z],decls:6,vars:2,consts:[[1,"row","g-sm-4","g-2"],[1,"col-xl-12"],[1,"row","roles-form"],[1,"col-12"],[1,"form-check","form-switch"],["type","checkbox",1,"checkbox_animated","form-check-input","checkall",3,"change","id","checked"],[1,"form-check-label","m-0","form-label",3,"for"],["type","checkbox",1,"checkbox_animated","form-check-input","check-it",3,"change","name","id","checked","value"]],template:function(t,e){t&1&&(_(0,"div",0)(1,"div",1)(2,"div",2),R(3,Pe,13,11,"div",3,fe),a(5,"async"),f()()()),t&2&&(r(3),A(l(5,0,e.modules$)))},dependencies:[X,S,Q,W,E],encapsulation:2});let s=o;return s})();function xe(s,o){s&1&&(c(0,"div",4),d(1),a(2,"translate"),h()),s&2&&(r(),v(l(2,1,"name_is_required")))}function ge(s,o){s&1&&(c(0,"div",8),d(1),a(2,"translate"),h()),s&2&&(r(),v(l(2,1,"permissions_is_required")))}var He=(()=>{let o=class o{constructor(){this.store=u(g),this.route=u(Y),this.router=u(Z),this.formBuilder=u(ne),this.type=K(void 0),this.permissions=[],this.destroy$=new G,this.form=this.formBuilder.group({name:new D("",[q.required]),permissions:new D("",[q.required])})}get permissionControl(){return this.form.get("permissions")}ngOnInit(){this.route.params.pipe(j(i=>i.id?this.store.dispatch(new ue(i.id)).pipe(U(()=>this.store.select(F.selectedRole))):O()),L(this.destroy$)).subscribe(i=>{this.id=i?.id;let t=i?.permissions.map(e=>e?.id);this.permissions=t,this.form.patchValue({name:i?.name,permissions:t})})}setPermissions(i){Array.isArray(i)&&this.form.controls.permissions.setValue(i)}submit(){this.form.markAllAsTouched();let i=new ce(this.form.value);this.type()=="edit"&&this.id&&(i=new he(this.form.value,this.id)),this.form.valid&&this.store.dispatch(i).subscribe({complete:()=>{this.router.navigateByUrl("/role")}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=y({type:o,selectors:[["app-form-role"]],inputs:{type:[1,"type"]},decls:17,vars:18,consts:[[1,"theme-form","theme-form-2","mega-form",3,"ngSubmit","formGroup"],[1,"row"],[3,"label","for","required"],["type","text","name","name","formControlName","name",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],[1,"mb-3","d-flex"],[1,"form-label-title"],[1,"theme-color","ms-2","required-dot"],[1,"mt-0","ms-4","invalid-feedback"],[3,"setPermissions","selectedPermission"],[3,"id"]],template:function(t,e){t&1&&(c(0,"form",0),$("ngSubmit",function(){return e.submit()}),c(1,"div",1)(2,"app-form-fields",2),H(3,"input",3),a(4,"translate"),T(5,xe,3,3,"div",4),h(),c(6,"div",5)(7,"h4",6),d(8),a(9,"translate"),c(10,"span",7),d(11,"*"),h()(),T(12,ge,3,3,"div",8),h(),c(13,"app-permissions",9),$("setPermissions",function(p){return e.setPermissions(p)}),h()(),c(14,"app-button",10),d(15),a(16,"translate"),h()()),t&2&&(k("formGroup",e.form),r(2),k("label","name")("for","name")("required",!0),r(),k("placeholder",x(l(4,12,"enter_name"))),r(2),M(e.form.controls.name.touched&&(e.form.controls.name.errors!=null&&e.form.controls.name.errors.required)?5:-1),r(3),b(" ",l(9,14,"permissions")," "),r(4),M(e.form.controls.permissions.touched&&e.form.controls.permissions.invalid?12:-1),r(),k("selectedPermission",e.permissions),r(),k("id","role_btn"),r(),v(l(16,16,"save")))},dependencies:[S,me,oe,ee,ie,te,ae,re,se,de,_e,le,E],encapsulation:2});let s=o;return s})();export{He as a};
